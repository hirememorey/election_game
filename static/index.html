<!DOCTYPE html>
<html>
<head>
    <title>Election: The Game</title>
    <style>
        body { font-family: sans-serif; background-color: #f0f0f0; color: #333; }
        #game-container { max-width: 800px; margin: auto; background: #fff; padding: 20px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        .player { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; }
        .current-player { border-color: #007bff; border-width: 2px; }
        .log-entry { padding: 5px; border-bottom: 1px solid #eee; }
        #actions button { display: block; margin: 5px 0; padding: 10px; width: 100%; background-color: #007bff; color: white; border: none; cursor: pointer; }
        #actions button:hover { background-color: #0056b3; }
    </style>
</head>
<body>
    <div id="game-container">
        <h1>Election: The Game</h1>
        <div id="game-state"></div>
        <div id="log"></div>
        <div id="actions"></div>
    </div>

    <script>
        const socket = new WebSocket(`ws://${window.location.host}/ws`);

        socket.onmessage = function(event) {
            const gameState = JSON.parse(event.data);
            renderGameState(gameState);
        };

        function renderGameState(state) {
            const stateDiv = document.getElementById('game-state');
            const logDiv = document.getElementById('log');
            const actionsDiv = document.getElementById('actions');

            // Clear previous state
            stateDiv.innerHTML = '';
            logDiv.innerHTML = '<h2>Log</h2>';
            actionsDiv.innerHTML = '<h2>Your Actions</h2>';

            // Render game info
            stateDiv.innerHTML += `<div>Round: ${state.round_marker}</div>`;
            stateDiv.innerHTML += `<div>Phase: ${state.current_phase}</div>`;
            
            // Render players
            state.players.forEach(player => {
                const playerDiv = document.createElement('div');
                playerDiv.className = 'player';
                if (player.name === state.current_player) {
                    playerDiv.classList.add('current-player');
                }
                playerDiv.innerHTML = `
                    <h3>${player.name} (${player.archetype.title})</h3>
                    <p>PC: ${player.pc}</p>
                    <p>Office: ${player.current_office ? player.current_office.title : 'None'}</p>
                `;
                stateDiv.appendChild(playerDiv);
            });

            // Render log
            state.log.forEach(entry => {
                const logEntry = document.createElement('div');
                logEntry.className = 'log-entry';
                logEntry.textContent = entry;
                logDiv.appendChild(logEntry);
            });

            // Render actions for human player
            if (state.valid_actions) {
                state.valid_actions.forEach(action => {
                    const button = document.createElement('button');
                    // Create a user-friendly description for the action
                    button.textContent = getActionDescription(action);
                    button.onclick = () => {
                        // We need to handle actions that require more input,
                        // like choosing an amount or target. This is a simplified example.
                        if (action.action_type === 'ActionSupportLegislation' || action.action_type === 'ActionOpposeLegislation') {
                            const amount = prompt("Enter PC amount to commit:", "1");
                            if (amount) {
                                action.support_amount = parseInt(amount);
                                action.oppose_amount = parseInt(amount);
                            }
                        }
                        socket.send(JSON.stringify(action));
                    };
                    actionsDiv.appendChild(button);
                });
            }
        }

        function getActionDescription(action) {
            // This function creates a user-friendly string from the action object.
            // It can be expanded to be more descriptive.
            let desc = action.action_type.replace('Action', '');
            if (action.legislation_id) desc += `: ${action.legislation_id}`;
            if (action.office_id) desc += `: ${action.office_id}`;
            return desc;
        }

    </script>
</body>
</html> 